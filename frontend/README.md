# AIWeb å‰ç«¯ï¼ˆReactï¼‰ğŸ’»

è¿™é‡Œæ˜¯ AIWeb çš„å‰ç«¯ç•Œé¢ï¼š  
ç”¨ React + Vite å†™çš„ä¸€ä¸ªã€Œå¤šæ¨¡å‹èŠå¤© + çŸ¥è¯†åº“ + è®°å¿†é¢æ¿ã€å°æ§åˆ¶å°ã€‚ğŸ˜

å’ŒåŸæ¥çš„é™æ€ HTML/CSS/JS ç›¸æ¯”ï¼Œè¿™é‡Œå¤šäº†ï¼š

- ç»„ä»¶åŒ–å¸ƒå±€ï¼ˆSidebar / Header / Chat / Inputï¼‰
- WebSocket æµå¼æ¶ˆæ¯ç®¡ç†
- Markdown + ä»£ç é«˜äº® + å¤åˆ¶æŒ‰é’®
- å›½é™…åŒ–ï¼ˆä¸­è‹±æ–‡åˆ‡æ¢ï¼‰

## ğŸ§° æŠ€æœ¯æ ˆ

- âš›ï¸ **React 18** + **Vite 5**
- ğŸ“ **marked**ï¼šMarkdown æ¸²æŸ“
- ğŸŒˆ **highlight.js**ï¼šä»£ç é«˜äº®

## ğŸ“ é¡¹ç›®ç»“æ„ï¼ˆå‰ç«¯ï¼‰

```
frontend/
â”œâ”€â”€ index.html          # Vite å…¥å£é¡µ
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js      # å¼€å‘æ—¶ä»£ç† /api åˆ°åç«¯ 8000 ç«¯å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.jsx        # React å…¥å£
â”‚   â”œâ”€â”€ App.jsx         # æ ¹ç»„ä»¶ï¼ˆå¸ƒå±€ã€ä¸»é¢˜ã€èŠå¤©çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ index.css       # å…¨å±€æ ·å¼ï¼ˆä¸åŸ main.css ä¸€è‡´ï¼‰
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx   # ä¾§è¾¹æ 
â”‚   â”‚   â”œâ”€â”€ Header.jsx    # é¡¶æ ï¼ˆä¸»é¢˜åˆ‡æ¢ã€æ¨¡å‹é€‰æ‹©ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ Welcome.jsx   # æ¬¢è¿åŒº + èŠå¤©åˆ—è¡¨å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ Chat.jsx      # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ ChatMessage.jsx # å•æ¡æ¶ˆæ¯ï¼ˆæ”¯æŒ Markdown/ä»£ç é«˜äº®/å¤åˆ¶ï¼‰
â”‚   â”‚   â””â”€â”€ InputArea.jsx # è¾“å…¥æ¡†ä¸å‘é€
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useTheme.js   # äº®/æš—ä¸»é¢˜ä¸ localStorage
â”‚   â”‚   â””â”€â”€ useChat.js    # WebSocket èŠå¤©ä¸æµå¼è¾“å‡º
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ markdown.js   # Markdown è§£æã€ä»£ç é«˜äº®ã€å¤åˆ¶
â”œâ”€â”€ css/main.css        # åŸé™æ€ç‰ˆæ ·å¼ï¼ˆä¿ç•™ï¼‰
â””â”€â”€ js/main.js          # åŸé™æ€ç‰ˆé€»è¾‘ï¼ˆä¿ç•™ï¼‰
```

## ğŸš€ å¼€å‘ä¸æ„å»º

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘ï¼ˆé»˜è®¤ http://localhost:5173ï¼Œ/api ä»£ç†åˆ°åç«¯ 8000ï¼‰
npm run dev

# æ„å»º
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

## ğŸ§­ å½“å‰ç•Œé¢ä¸è·¯ç”±ï¼ˆå¼€å‘ç¯å¢ƒ base: http://localhost:5173ï¼‰

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `/login` | ç™»å½•é¡µï¼ˆæœªç™»å½•æ—¶å…¥å£ï¼Œé‚®ç®±+å¯†ç ç™»å½•ï¼‰ |
| `/register` | æ³¨å†Œé¡µï¼ˆé‚®ç®±ã€å¯†ç ã€ç”¨æˆ·åã€æ‰‹æœºå·ï¼Œå¯¹åº”åç«¯ users è¡¨ï¼‰ |
| `/` | ä¸»èŠå¤©é¡µï¼ˆé¦–é¡µï¼Œéœ€ç™»å½•ï¼‰ |
| `/wiki` | RAG çŸ¥è¯†åº“ / ä»ªè¡¨ç›˜ï¼ˆéœ€ç™»å½•ï¼‰ |
| `/wiki/search` | RAG æœç´¢é¡µï¼ˆéœ€ç™»å½•ï¼‰ |

æœªç™»å½•è®¿é—® `/`ã€`/wiki`ã€`/wiki/search` ä¼šé‡å®šå‘åˆ° `/login`ï¼›å·²ç™»å½•è®¿é—® `/login` æˆ– `/register` ä¼šé‡å®šå‘åˆ° `/`ï¼Œ  
ä¿è¯ã€Œå…ˆç™»å½•ï¼Œå†ç© AIã€ï¼Œä½“éªŒå’Œå®‰å…¨æ„Ÿéƒ½åœ¨çº¿ã€‚ğŸ”

## ğŸ”Œ ä¸åç«¯è”è°ƒ

1. å¯åŠ¨åç«¯ï¼š`cd backend && uvicorn main:app --host 0.0.0.0 --port 8000`
2. å¯åŠ¨å‰ç«¯ï¼š`cd frontend && npm run dev`
3. æµè§ˆå™¨è®¿é—® `http://localhost:5173`ï¼Œå‰ç«¯é€šè¿‡ Vite ä»£ç†å°† `/api` å’Œ WebSocket è¯·æ±‚è½¬å‘åˆ° 8000 ç«¯å£ã€‚

## ğŸ§  å‰ç«¯åŠŸèƒ½è¯´æ˜

- ğŸ¨ **ä¸»é¢˜**ï¼š`useTheme` ç®¡ç†äº®/æš—ä¸»é¢˜ï¼Œå†™å…¥ `data-theme` ä¸ localStorageã€‚
- ğŸ“š **ä¾§è¾¹æ **ï¼š`Sidebar` è´Ÿè´£ä¼šè¯åˆ—è¡¨ä¸å¯¼èˆªï¼Œæ”¯æŒç§»åŠ¨ç«¯å±•å¼€/æ”¶èµ·ã€‚
- ğŸ’¬ **èŠå¤©æµ**ï¼š`useChat` ç»´æŠ¤æ¶ˆæ¯åˆ—è¡¨ã€æµå¼å†…å®¹ä¸ WebSocketï¼Œæ”¯æŒæš‚åœç”Ÿæˆã€‚
- ğŸ“ **æ¶ˆæ¯æ¸²æŸ“**ï¼š`ChatMessage` å¯¹ assistant æ¶ˆæ¯åš Markdown æ¸²æŸ“ã€ä»£ç é«˜äº®ä¸ä¸€é”®å¤åˆ¶ã€‚
- ğŸ“ **Quick Parse æ–‡ä»¶é¢„è§ˆ**ï¼š`InputArea` æ”¯æŒé™„ä»¶ä¸Šä¼ ä¸æ ¡éªŒï¼›`ChatMessage` ä»¥æ–‡ä»¶å¡ç‰‡å±•ç¤ºå¹¶æç¤ºä¸è¿›å…¥é•¿æœŸè®°å¿†ã€‚
- ğŸ“š **RAG é¡µ**ï¼šçŸ¥è¯†æºå‹¾é€‰ã€æ£€ç´¢æ–‡æ¡£å¡ç‰‡ï¼ˆè¡¨æ ¼/å›¾ç‰‡/å…¬å¼å¯Œæ–‡æœ¬ï¼‰ã€å±•å¼€æ–‡ä»¶å®šä½é«˜äº®ã€æ¥æºæŒ‡å—å±•ç¤ºã€‚

---

## ğŸ”„ å®ç°æµç¨‹ä¸æŠ€æœ¯æµç¨‹

### å®ç°æµç¨‹ï¼ˆå…³é”®è·¯å¾„ï¼‰

1. **ä¸»èŠå¤©é¡µå‘é€æ¶ˆæ¯**
   - ç”¨æˆ·è¾“å…¥ â†’ `InputArea` è§¦å‘ `onSend` â†’ `useChat.sendMessage(text, modelId, conversationId?, quickParseFiles?, ragContext?)`ã€‚
   - `sendMessage` å»ºç«‹/å¤ç”¨ WebSocketï¼Œå‘é€ `{ message, model_id, conversation_id?, rag_context?, quick_parse_files? }`ã€‚
   - æœåŠ¡ç«¯æµå¼è¿”å› content ä¸ doneï¼›`useChat` å°† content ç´¯åŠ åˆ° `streamingContent`ï¼Œdone åè¿½åŠ åˆ° `messages` å¹¶æ¸…ç©ºæµã€‚
   - **æ»šåŠ¨**ï¼š`Chat` ç»„ä»¶åœ¨æ¶ˆæ¯/æµæ›´æ–°åï¼Œåœ¨**å¯æ»šåŠ¨ç¥–å…ˆå®¹å™¨**å†…æ‰§è¡Œ `scrollTo({ top: scrollHeight })`ï¼Œé¿å…æ•´é¡µæ»šåŠ¨å¯¼è‡´ã€Œç•Œé¢ç¿»ä¸Šå»ã€ã€‚

2. **RAG æœç´¢é¡µï¼ˆwiki/searchï¼‰**
   - å·¦ä¾§çŸ¥è¯†æºåˆ—è¡¨æ¥è‡ª `GET /api/rag/documents?notebook_id=...`ï¼Œæ¯é¡¹å¸¦ checkboxï¼Œä»…å‹¾é€‰å‚ä¸æ£€ç´¢ã€‚
   - ç”¨æˆ·å‘é€é—®é¢˜æ—¶ï¼šå…ˆ `POST /api/rag/search`ï¼ˆbody å« `document_ids` ä¸ºå‹¾é€‰ id åˆ—è¡¨ï¼Œå¯ä¸ºç©ºï¼‰â†’ ç”¨ `buildRAGContextFromHits` æ‹¼æˆ `rag_context` å­—ç¬¦ä¸² â†’ å† `sendMessage(text, modelId, null, null, rag_context)`ã€‚
   - å³ä¾§ã€Œæ£€ç´¢æ–‡æ¡£ã€å±•ç¤º hits ä¸ºå¡ç‰‡ï¼šå†…å®¹åŒºç”¨ `processMarkdownHtml(parseMarkdownWithLatex(ensureImageUrlsInContent(content)))` æ¸²æŸ“ï¼ˆè¡¨æ ¼/å›¾ç‰‡/å…¬å¼ï¼‰ï¼›å¡ç‰‡ä¸Šã€Œå±•å¼€æ–‡ä»¶ã€æ‰“å¼€å¼¹çª—ï¼Œä¼ å…¥ `chunkId`/`chunkSnippet`ï¼ŒåŠ è½½ markdown æ¥å£åå®šä½åˆ°å¯¹åº” segment å¹¶é«˜äº®ã€‚

3. **å¸ƒå±€ä¸æ»šåŠ¨çº¦æŸ**
   - ä¸»å¯¹è¯ä¸ RAG é¡µå‡å¯¹ä¸­å¤® `.welcome` ä½¿ç”¨ `min-height: 0` + `flex: 1 1 0`ï¼Œä¿è¯å¯¹è¯åŒºåœ¨è§†å£å†…ç‹¬ç«‹æ»šåŠ¨ï¼›RAG å³ä¾§æ  `min-height: 0` + `overflow-y: auto`ï¼Œå¡ç‰‡å†å¤šä¹Ÿåªå³ä¾§å†…éƒ¨æ»šåŠ¨ã€‚

### æŠ€æœ¯æµç¨‹ï¼ˆåˆ†å±‚ï¼‰

| å±‚çº§ | è¯´æ˜ |
|------|------|
| è·¯ç”± | React Routerï¼š`/` ä¸»èŠå¤©ï¼Œ`/wiki` çŸ¥è¯†åº“ä»ªè¡¨ç›˜ï¼Œ`/wiki/search` RAG æ£€ç´¢ä¸å¯¹è¯ï¼Œ`/login`ã€`/register` |
| çŠ¶æ€ | `useChat`ï¼ˆæ¶ˆæ¯ã€æµã€WebSocketï¼‰ã€RAG é¡µï¼ˆsourcesã€retrievedDocsã€expandDocï¼‰ã€ä¸»é¢˜ä¸ä¾§æ å¼€å…³ |
| è¯·æ±‚ | `fetch` / WebSocketï¼›Vite ä»£ç† `/api` ä¸ ws åˆ°åç«¯ 8000ï¼›`ragApi.js` å°è£… RAG ç›¸å…³ API |
| æ¸²æŸ“ | Markdown+LaTeXï¼ˆmarked + KaTeXï¼‰ã€ä»£ç é«˜äº®ï¼ˆhighlight.jsï¼‰ã€RAG å¡ç‰‡å¯Œæ–‡æœ¬ä¸å±•å¼€å¼¹çª— |

> åŸé™æ€é¡µé¢ä»ä¿ç•™åœ¨ `index.html` ä¸­è¢« Vite æ¥ç®¡ï¼›æ ·å¼å¤‡ä»½åœ¨ `css/main.css`ï¼Œé€»è¾‘åœ¨ `js/main.js`ã€‚ğŸ§ª
